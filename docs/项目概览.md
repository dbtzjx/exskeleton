## 项目概览

本项目用于实现 **康复外骨骼（外甲）控制系统** 的上位/主控程序，包括：

- 主控与各电机驱动之间的 CAN 通讯。
- 髋关节、踝关节等多关节协调与联动控制。
- 后续扩展的人机交互、训练模式与安全机制。

---

## 系统角色与边界（初稿）

- **主控（MCU / 工控机 / 嵌入式主板）**
  - 负责：上位逻辑、姿态/步态规划、状态机管理、安全限幅等。
  - 与电机驱动通过 **CAN 总线** 通讯，发送目标指令、读取状态反馈。

- **电机驱动 / 伺服电机**
  - 根据 CAN 协议接收主控指令（位置/速度/电流/模式等）。
  - 实时反馈编码器、转速、电流、温度、故障状态等信息。
  - 具体协议参考 `D:\project\康复外甲\控制程序\exskeleton-demo\参考资料\电机 CAN 总线通讯协议（V2.35）整理.md`。

- **机械结构（髋、膝、踝等）**
  - 电机通过减速机构/连杆与关节相连。
  - 髋踝联动的具体参数、调试步骤参考 `D:\project\康复外甲\控制程序\exskeleton-demo\参考资料\髋踝联动调试方案V2.md`。

---

## 当前工作阶段

### ✅ 阶段一：基础通讯与控制（已完成）

1. **CAN 协议实现**
   - 完成电机 CAN 协议 V2.35 的实现
   - 支持使能（0x88）、掉电（0x80）、停止（0x81）命令
   - 支持多圈角度读取（0x92）、位置控制（0xA3/0xA4）
   - 实现反馈帧解析（状态、角度、速度、温度等）

2. **基础控制功能**
   - 电机使能/掉电/停止
   - 多圈角度读取与显示
   - 位置控制指令发送
   - 摆动功能测试
   - 串口交互调试工具

### 🔄 阶段二：早期被动模式（进行中）

**控制原则**：
- 将肢体柔和的送到指定位置，遇到强阻力要有一定的柔性
- 整体控制要柔和，不能像机器人一样带着病人动
- 辅助强度要能调节，按照不同阶段康复需求

**开发任务**：
1. **标准步态轨迹生成**
   - 实现髋踝联动曲线（基于标准步态数据）
   - 步态周期管理（相位识别、循环控制）
   - 轨迹平滑处理（确保运动柔和）

2. **位置控制优化**
   - 速度/加速度限制（确保运动柔和）
   - 阻力检测与柔性响应（遇到强阻力时降低控制力度）
   - 位置控制精度调试

3. **髋踝联动实现**
   - 根据髋关节角度计算踝关节目标角度
   - 实现联动控制逻辑
   - 测试联动效果

### 📋 阶段三：主动激发模式（规划中）

**目标**：减弱被动模式的控制力度，以激发患者主动性为主

**开发任务**：
1. **健侧腿步态学习**
   - 记录健侧腿运动轨迹
   - 模拟健侧腿运动模式进行训练

2. **误差允许机制**
   - 避免人机对抗
   - 允许患者主动偏离预设轨迹

3. **辅助强度调节**
   - 根据康复阶段调整辅助强度
   - 患者主动性越强，辅助强度越弱

### 📋 阶段四：主动康复模式（规划中）

**目标**：主要采用力矩模式进行控制，感知患者意图，按比例提供助力

**开发任务**：
1. **力矩控制模式**
   - 实现转矩闭环控制（命令 0xA1）
   - 力矩指令发送与反馈

2. **患者意图感知**
   - 通过力矩/位置偏差判断患者意图
   - 适时按比例提供助力

3. **混合控制策略**
   - 关键相位重点辅助（如踝关节屈伸）
   - 根据动作阶段切换控制策略（位置+力矩）

### 📋 阶段五：精细化控制（规划中）

**目标**：根据不同动作阶段设置不同控制策略

**开发任务**：
1. **步态相位识别**
   - 支撑相、摆动相等相位识别
   - 根据相位切换控制策略

2. **分阶段控制配置**
   - 不同动作阶段的控制参数配置
   - 控制策略切换逻辑

3. **安全与评估**
   - 安全限位与急停机制
   - 数据记录与分析（用于康复评估）

---

## 文档配合方式

- **规范类文档**：集中写在 `docs/规范-电机CAN与髋踝联动.md`。
- **调试过程与问题记录**：写在 `docs/调试记录-主控与电机CAN.md`。
- **架构与设计**：持续更新当前 `docs/项目概览.md`，避免只存在于脑子里或聊天记录里。

